{% extends "global/Page.html" %} {% block content %}

<h1 style="display: none">Programming Task 1</h1>

<script>
  sendEvent("taskBegin");

  document.getElementById("browser").addEventListener("click", () => {
    sendEvent("googleClicked");
  });

  document.getElementById("editor").addEventListener("click", () => {
    sendEvent("editorClicked");
  });
  function runTests(event) {
    event.preventDefault();
    document.querySelector("#test-results").innerHTML = "Running tests...";
    let res = fetch("http://127.0.0.1:5000/run-tests")
      .then((res) => res.json())
      .then((res) => {
        if (res.error) {
          document.querySelector("#test-results").innerHTML = res.error;
        } else {
          document.querySelector("#test-results").innerHTML = res.output;
        }
      });
    sendEvent("runTests");
  }

  function iframeReset(event) {
    event.preventDefault();
    document.getElementById("browser").src = "https://www.google.com/";
  }

  function showTask(event) {
    event.preventDefault();
    document.querySelector("dialog").setAttribute("open", "true");
    sendEvent("showTask");
  }
  function hideTask(event) {
    event.preventDefault();
    document.querySelector("dialog").removeAttribute("open");
    sendEvent("hideTask");
  }

  document.addEventListener("keydown", function (event) {
    if (
      event.key === "Enter" &&
      event.target.tagName !== "INPUT" &&
      event.target.tagName !== "TEXTAREA"
    ) {
      event.preventDefault();
    }
  });

  document.addEventListener("keydown", function (event) {
    if (
      event.key === "Enter" &&
      event.target.tagName === "INPUT" &&
      event.target.id === "gpt-input"
    ) {
      event.preventDefault();
      sendMessage(event);
    }
  });
</script>

<div class="full split-window">
  <div class="menu">
    <button onclick="showTask(event)">Show UML diagrams</button>
    <button onclick="runTests(event)">Run Tests</button>
    <div id="test-results"></div>
  </div>
  <div class="menu">
    {% if useAI %}{%else%}
    <button onclick="iframeReset(event)">Go to Google frontpage</button>
    {% endif %}
  </div>

  <!-- vs code above -->
  <iframe id="editor" src="http://localhost/"></iframe>

  <!-- browser below -->

  {% if useAI %}
  <div class="gpt-window">{% include "ChatGPT.html" %}</div>
  {%else%}
  <iframe src="https://www.google.com/" id="browser"></iframe>
  {% endif %}
</div>

<button
  class="btn btn-primary"
  onclick="document.getElementById('next-button').click();"
>
  Continue
</button>

<dialog>
  <button class="close" onclick="hideTask(event)">âœ•</button>
  {% if id == 1 %} {% include "TaskDescription1.html" %} {% else %} {% include
  "TaskDescription2.html" %} {% endif %}
</dialog>

<style>
  .split-window {
    height: calc(100vh);
    display: grid;
    grid-template-columns: 50% 50%;
    grid-auto-rows: min-content;
  }
  .split-window .menu {
    display: flex;
    height: 50px;
    align-items: center;
    gap: 10px;
    padding: 10px;
  }
  .split-window .menu button {
    border: none;
    background: transparent;
    box-shadow: 0 0 10px -6px;
    border-radius: 50px;
    padding: 4px 14px;
    transition: all 0.2s;
  }
  .split-window .menu button:hover {
    box-shadow: 0 0 10px -3px;
  }
  iframe,
  .gpt-window {
    width: 100%;
    max-width: 50vw;
    height: calc(100vh - 50px);
    border: none;
  }
  dialog {
    top: 50%;
    translate: 0px -50%;
    max-width: 90vw;
  }
  dialog button.close {
    float: right;
    margin: 0px 0px 30px 30px;
    border: none;
    border-radius: 50px;
    padding: 3px 8px;
    background: rgb(240, 240, 240);
  }
  dialog button.close:hover {
    background: rgb(220, 220, 220);
  }
</style>

{% endblock %}
